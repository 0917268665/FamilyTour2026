<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>昇龍道.黑部立山 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@500;700&family=Zen+Old+Mincho:wght@400;700&display=swap');
        
        :root {
            --bg-paper: #f9f8f6;
            --text-main: #2c2c2c;
            --text-sub: #8c8c8c;
            --accent: #b08d76; /* 莫蘭迪棕 */
            --accent-light: #f0ebe7;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--bg-paper); 
            color: var(--text-main); 
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
        }

        h1, h2, h3, .serif { font-family: 'Noto Serif TC', serif; }
.jp-font { 
            /* 第一順位：iPhone 內建的日文黑體 (ProN) */
            /* 第二順位：新款 iPhone 的日文黑體 (Sans) */
            /* 第三順位：Windows 的日文黑體 (Meiryo) */
            /* 最後手段：無襯線體 */
            font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Meiryo", sans-serif !important;
            
            /* 強制加粗 */
            font-weight: 700; 
            
            /* 稍微調整字距，讓日文更好讀 */
            letter-spacing: 0.02em;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeUp 0.5s ease-out forwards; }

        .timeline-line {
            position: absolute;
            left: 24px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background-image: linear-gradient(to bottom, #e5e5e5 50%, transparent 50%);
            background-size: 2px 10px;
            z-index: 0;
        }
        .last-item .timeline-line { display: none; }

        .soft-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        
        .nav-blur {
            background: rgba(249, 248, 246, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item.active { color: #2c2c2c; }
        .nav-item.active i { stroke-width: 2.5px; }
        .nav-item { color: #b0b0b0; }

        .big-card-modal {
            background-color: #fffaf5;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23dcc8b8' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }
        
        .check-icon { opacity: 0; transform: scale(0.5); transition: all 0.2s; }
        input:checked + div { background-color: #2c2c2c; border-color: #2c2c2c; }
        input:checked + div .check-icon { opacity: 1; transform: scale(1); }
        input:checked ~ span { text-decoration: line-through; color: #b0b0b0; }
        
        #header { background-color: rgba(249, 248, 246, 0.98); }
    </style>
</head>
<body class="pb-24">

    <!-- Header -->
    <div class="fixed top-0 left-0 right-0 z-30 transition-all shadow-sm duration-500" id="header">
        <div class="absolute inset-0 z-0 overflow-hidden">
            <img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=2070&auto=format&fit=crop" class="w-full h-full object-cover opacity-20 filter blur-[2px]" alt="Background">
            <div class="absolute inset-0 bg-gradient-to-b from-white/90 via-[#f9f8f6]/95 to-[#f9f8f6]"></div>
        </div>

        <div class="relative z-10 px-6 pt-4 pb-2 text-center">
            <p class="text-[10px] tracking-[0.3em] text-[#b08d76] uppercase mb-1 font-bold">Family Trip 2026</p>
            <h1 class="text-2xl font-serif font-bold tracking-widest text-stone-800 mb-1">昇龍道.黑部立山</h1>
            
            <div id="countdown-timer" class="text-xs font-mono text-stone-500 mb-3 bg-white/50 inline-block px-3 py-1 rounded-full border border-stone-200/50 backdrop-blur-sm">
                計算中...
            </div>
        </div>
        
        <div id="day-selector" class="relative z-10 flex overflow-x-auto gap-6 no-scrollbar justify-start px-4 pb-2 snap-x transition-all duration-300"></div>
    </div>

    <!-- Main Scroll Area -->
    <div id="main-container" class="pt-48 px-5 min-h-screen"></div>

    <!-- Navigation -->
    <div class="nav-blur fixed bottom-0 left-0 right-0 px-6 py-3 flex justify-between items-center z-40">
        <button onclick="switchTab('itinerary')" id="nav-itinerary" class="nav-item active flex flex-col items-center gap-1"><i data-lucide="map" class="w-5 h-5"></i><span class="text-[9px] font-bold tracking-widest">行程</span></button>
        <button onclick="switchTab('hotels')" id="nav-hotels" class="nav-item flex flex-col items-center gap-1"><i data-lucide="bed-double" class="w-5 h-5"></i><span class="text-[9px] font-bold tracking-widest">住宿</span></button>
        <button onclick="switchTab('drive')" id="nav-drive" class="nav-item flex flex-col items-center gap-1"><i data-lucide="car" class="w-5 h-5"></i><span class="text-[9px] font-bold tracking-widest">自駕</span></button>
        <button onclick="switchTab('tools')" id="nav-tools" class="nav-item flex flex-col items-center gap-1"><i data-lucide="briefcase" class="w-5 h-5"></i><span class="text-[9px] font-bold tracking-widest">工具</span></button>
    </div>

    <!-- Modal: Spot Detail -->
    <div id="detail-modal" class="fixed inset-0 z-50 hidden flex items-end sm:items-center justify-center pointer-events-none">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-[2px] transition-opacity opacity-0 pointer-events-auto" id="modal-backdrop" onclick="closeModal()"></div>
        <div class="bg-white w-full max-w-md h-[85vh] sm:h-[800px] sm:rounded-2xl rounded-t-3xl shadow-2xl transform translate-y-full transition-transform duration-300 pointer-events-auto flex flex-col relative" id="modal-panel">
            
            <!-- Close Button -->
            <button onclick="closeModal()" class="absolute top-4 right-4 p-2 bg-stone-100 rounded-full text-stone-500 hover:bg-stone-200 z-20 active:scale-90 transition-transform">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <div class="w-full flex justify-center pt-3 pb-1" onclick="closeModal()"><div class="w-12 h-1.5 bg-gray-200 rounded-full"></div></div>
            <div class="flex-1 overflow-y-auto p-6 pt-2"><div id="modal-content"></div></div>
            <div class="p-4 border-t border-gray-50 bg-white safe-area-bottom">
                <button onclick="openMap()" class="w-full bg-[#2c2c2c] text-white py-3.5 rounded-xl font-bold tracking-wider flex items-center justify-center gap-2 active:scale-95 transition-transform">
                    <i data-lucide="navigation" class="w-4 h-4"></i> 開啟 Google Maps 導航
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Big Card -->
    <div id="big-card-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-white p-6 cursor-pointer big-card-modal" onclick="closeBigCard()">
        <div class="text-center w-full">
            <p class="text-xs text-stone-400 tracking-[0.3em] uppercase mb-10">Tap to Close</p>
            <h2 id="big-card-jp" class="text-5xl font-bold text-stone-800 mb-6 leading-tight jp-font"></h2>
            <p id="big-card-zh" class="text-xl text-stone-500 font-medium"></p>
            <div class="mt-12 border-t border-stone-200 pt-8 inline-block">
                <p class="text-sm font-bold text-stone-800 bg-white px-4 py-2 rounded-full shadow-sm">給店員看的放大字卡</p>
            </div>
        </div>
    </div>

<script>
    // ---------------------------------------------------------
    // 1. DATA DEFINITIONS
    // ---------------------------------------------------------
    const TRIP_DATA = [
        {
            day: "Day 1", date: "4/11", weekday: "SAT", location: "名古屋",
            lat: 35.18, lon: 136.90,
            highlights: [
                { time: "07:30", type: "FLIGHT", title: "CI 0154 台北 ➔ 名古屋", desc: "11:20 抵達中部國際機場 (NGO)", icon: "plane", booking: "訂位代號: FK3SJX" },
                { 
                    time: "12:00", type: "CAR", title: "取車：日產レンタカー", 
                    desc: "中部國際機場店 / Serena e-Power", 
                    address: "愛知県常滑市セントレア1-1", tel: "0569-38-1123", 
                    booking: "預約號: 123098386", 
                    link: "https://www.tabirai.net/car/search/UserLogin.aspx?YNO=123098386",
                    tips: "密碼: 17f23cd8 / 現場付 ¥148,632", icon: "car" 
                },
                { 
                    time: "13:30", type: "FOOD", title: "午餐：炭焼 うな富士", sub: "名古屋三大美食：鰻魚飯", 
                    address: "愛知県名古屋市昭和区白金1-1-4", tel: "052-881-0067",
                    desc: "【米其林必比登推薦】\n不同於一般的鰻魚店，這裡使用的是「青鰻」，肉質肥厚，炭火烤過後外皮酥脆，油脂豐富。必點「肝入りうなぎ丼（鰻肝蓋飯）」或「ひつまぶし（鰻魚三吃）」。",
                    menu: [ { name: "上鰻魚三吃", jp: "上ひつまぶし", price: "¥5,170" }, { name: "鰻肝蓋飯", jp: "肝入りうなぎ丼", price: "¥6,050" } ],
                    tabelog: 'https://tabelog.com/aichi/A2301/A230105/23000105/'
                },
                { time: "15:30", type: "STAY", title: "Check-in: Comfort Hotel", desc: "Nagoya Shinkansenguchi", address: "愛知県名古屋市中村区則武1-13-7", tel: "052-453-3111", booking: "CONF#80886535", icon: "bed" },
                { 
                    time: "16:30", type: "SIGHT", title: "大須觀音 & 商店街", sub: "雨天備案 / 逛街",
                    address: "愛知県名古屋市中区大須2丁目21-47",
                    desc: "【名古屋的秋葉原】\n有著400多年歷史的觀音寺，旁邊連接著巨大的拱廊商店街，無論晴雨都很好逛。有許多古著店、電器行與異國美食。"
                },
                { 
                    time: "17:30", type: "FOOD", title: "下午茶：HARBS 本店", sub: "水果千層蛋糕",
                    address: "愛知県名古屋市中区錦3-6-17",
                    desc: "【甜點控的朝聖地】\n發源於名古屋的 HARBS，榮本店是必去之處。招牌「水果千層蛋糕」夾滿了哈密瓜、奇異果、香蕉等新鮮水果，搭配不甜膩的鮮奶油，是完美的下午茶選擇。",
                    menu: [ { name: "水果千層", jp: "ミルクレープ", price: "¥980" } ],
                    tabelog: 'https://tabelog.com/aichi/A2301/A230103/23000028/'
                },
                { 
                    time: "18:30", type: "SIGHT", title: "綠洲21 & 電視塔", sub: "宇宙飛船夜景",
                    address: "愛知県名古屋市東区東桜1-11-1",
                    desc: "【水的宇宙船】\n巨大的玻璃屋頂上方有水流動，晚上點燈後非常科幻。可以上去屋頂散步，拍攝與名古屋電視塔的合照。"
                },
                { 
                    time: "19:30", type: "FOOD", title: "晚餐：世界的山醬", sub: "夢幻手羽先", address: "名古屋駅周邊", 
                    desc: "【名古屋的靈魂食物】\n雖然台灣也有分店，但名古屋當地的胡椒味更重、更香脆！這家店創立於1981年，靠著這道「夢幻雞翅」征服了全日本。\n\n【吃法攻略】\n抓住雞翅兩端，用力扭斷關節，然後將肉一口氣吸入，這就是在地人的豪邁吃法！",
                    menu: [ { name: "夢幻雞翅 (5支)", jp: "幻の手羽先", price: "¥605" }, { name: "味噌炸豬排串", jp: "みそ串カツ", price: "¥495" } ],
                    tabelog: 'https://tabelog.com/aichi/A2301/A230103/23000084/'
                }
            ]
        },
        {
            day: "Day 2", date: "4/12", weekday: "SUN", location: "中山道/高山",
            lat: 36.14, lon: 137.25,
            highlights: [
                { time: "08:00", type: "DRIVE", title: "出發前往中山道", desc: "經由中央自動車道 (約1.5hr)", icon: "navigation" },
                { 
                    time: "09:30", type: "SIGHT", title: "馬籠宿", sub: "江戶時代石板坡道",
                    address: "岐阜県中津川市馬籠", mapcode: "178 355 491*22",
                    desc: "【走進時光隧道】\n中山道第43號宿場。特色是險峻的石板坡道，兩旁保留著江戶時代的木造建築。推薦品嚐當地的「五平餅」。"
                },
                { 
                    time: "10:30", type: "SIGHT", title: "妻籠宿", sub: "保存最完整的宿場",
                    address: "長野県木曽郡南木曽町吾妻", mapcode: "178 506 332*20",
                    desc: "【日本第一個傳統建物保存區】\n相比馬籠宿的熱鬧，妻籠宿更顯質樸寧靜。這裡完整保留了百年前的風貌，完全看不到電線桿。"
                },
                { 
                    time: "13:30", type: "SIGHT", title: "高遠城址公園", sub: "天下第一櫻",
                    address: "長野県伊那市高遠町東高遠", mapcode: "171 445 289*60",
                    desc: "【粉紅色的雲海】\n高遠城的小彼岸櫻花以花形小巧、顏色較紅為特徵，被譽為「天下第一櫻」。4月中旬是滿開期，整個公園被1500棵櫻花染成粉紅色，非常壯觀。"
                },
                { 
                    time: "15:30", type: "SIGHT", title: "奈良井宿", sub: "中山道最長宿場",
                    address: "長野県塩尻市奈良井", mapcode: "420 541 784*44",
                    desc: "【奈良井千軒】\n這是木曾路最北端的宿場，保留了江戶時代長達一公里的古老街道。必看地標是巨大的「木曾大橋」。"
                },
                { 
                    time: "19:30", type: "FOOD", title: "晚餐：味藏天國", sub: "JA農協直營 飛驒牛燒肉",
                    address: "岐阜県高山市花里4-147", tel: "0577-37-1129",
                    desc: "【絕對不會踩雷的飛驒牛】\n這家店是JA（日本農協）直營的，這意味著肉源絕對新鮮、品質由農協掛保證，而且價格比一般高級燒肉店親民。\n\n【部位推薦】\n如果預算足夠，直上「飛驒牛盛合（拼盤）」，可以一次吃到里肌、五花、骰子牛等不同部位，感受油脂在口中融化的幸福感。",
                    menu: [ { name: "味藏拼盤", jp: "味蔵盛り", price: "¥9,800" }, { name: "特上牛五花", jp: "特上カルビ", price: "¥2,480" } ],
                    tabelog: 'https://tabelog.com/gifu/A2104/A210401/21000287/'
                },
                { time: "21:00", type: "STAY", title: "hotel around TAKAYAMA", desc: "Ascend Hotel Collection", address: "岐阜県高山市花岡町1-42-7", tel: "0577-32-5002", booking: "CONF#78677355", icon: "bed" }
            ]
        },
        {
            day: "Day 3", date: "4/13", weekday: "MON", location: "奧飛驒/松本",
            lat: 36.23, lon: 137.97,
            highlights: [
                { 
                    time: "09:00", type: "SIGHT", title: "新穗高雙層纜車", sub: "標高2156m 雲上市界",
                    address: "岐阜県高山市奥飛騨温泉郷新穂高", tel: "0578-89-2252",
                    desc: "【米其林二星絕景】\n這是日本唯一的雙層纜車！山頂的展望台可以看到槍之岳、穗高連峰的 360 度全景。路程中會經過平湯溫泉，可視時間泡足湯。"
                },
                { 
                    time: "12:30", type: "FOOD", title: "午餐：松本炸雞 (山賊燒)", sub: "松本名物",
                    address: "松本市區 (推薦: 一歩)", 
                    desc: "【豪邁的帶骨炸雞】\n「山賊燒」其實是將整隻雞腿肉用大蒜、洋蔥醬油醃漬後酥炸的料理。外皮酥脆，肉汁豐富，是松本市民的最愛。",
                    menu: [ { name: "山賊燒定食", jp: "山賊焼き定食", price: "¥1,100" } ],
                    tabelog: 'https://tabelog.com/nagano/A2002/A200201/20000049/'
                },
                { 
                    time: "14:00", type: "SIGHT", title: "國寶 松本城", sub: "烏城 Black Castle",
                    address: "長野県松本市丸の内4-1", mapcode: "75 621 155*00",
                    desc: "【現存十二天守之一】\n因為外觀漆黑，又被稱為「烏城」。下午順光拍攝，黑色的城堡在北阿爾卑斯雪山的映襯下，顯得格外莊嚴肅穆。\n\n【建築特色】\n天守閣內部保留了戰國時代的結構，樓梯非常陡峭（最大斜度約61度），攀爬時請務必小心。"
                },
                { time: "18:00", type: "STAY", title: "hotel around TAKAYAMA", desc: "續住", booking: "CONF#78677355", icon: "bed" }
            ]
        },
        {
            day: "Day 4", date: "4/14", weekday: "TUE", location: "高山祭",
            lat: 36.14, lon: 137.25,
            highlights: [
                { 
                    time: "All Day", type: "SIGHT", title: "春之高山祭 (山王祭)", sub: "日本三大美祭",
                    address: "岐阜県高山市 日枝神社周邊", 
                    desc: "【活動的陽明門】\n高山祭的主角是 12 座裝飾華麗的「屋台（花車）」。這些屋台展現了飛驒工匠精湛的木工、漆藝與金屬工藝。\n\n【必看：機關人偶】\n其中幾座屋台上有「機關人偶（Karakuri）」，由操偶師在內部用線操控，人偶會做出變臉、寫字、跳舞等驚人動作，千萬別錯過表演時間！"
                },
                { 
                    time: "12:00", type: "FOOD", title: "小吃：坂口屋", sub: "飛驒牛握壽司",
                    address: "岐阜県高山市上三之町90",
                    desc: "【老街散步美食】\n這家是老街上最有名的小吃店之一。他們的飛驒牛握壽司不是放在盤子上，而是放在一片「仙貝」上，吃完壽司連盤子一起吃掉，環保又美味！\n牛肉表面稍微炙燒過，油脂香氣逼人，入口即化。",
                    menu: [ { name: "飛驒牛握壽司(2貫)", jp: "飛騨牛にぎり寿司", price: "¥800" } ],
                    tabelog: 'https://tabelog.com/gifu/A2104/A210401/21000020/'
                },
                { time: "18:00", type: "STAY", title: "hotel around TAKAYAMA", desc: "續住", booking: "CONF#78677355", icon: "bed" }
            ]
        },
        {
            day: "Day 5", date: "4/15", weekday: "WED", location: "富山",
            lat: 36.69, lon: 137.21,
            highlights: [
                { time: "AM", type: "SIGHT", title: "高山祭 (Day 2)", desc: "把握最後機會欣賞屋台巡遊", icon: "flag" },
                { 
                    time: "12:00", type: "FOOD", title: "午餐：Center4 Hamburgers", sub: "歐美客最愛 飛驒牛漢堡",
                    address: "岐阜県高山市上一之町94", tel: "0577-36-4527",
                    desc: "【藏在古民家裡的漢堡店】\n雖然外觀是傳統的日式古民家，推開門卻是濃濃的美式復古風。這裡的飛驒牛漢堡排多汁厚實，咬下去肉汁會噴發，是TripAdvisor上高山排名第一的名店。\n\n⚠️ 注意：店家座位極少，建議開店前排隊。",
                    menu: [ { name: "飛驒牛漢堡", jp: "飛騨牛バーガー", price: "¥2,850" }, { name: "酪梨起司漢堡", jp: "アボカドチーズ", price: "¥1,450" } ],
                    tabelog: 'https://tabelog.com/gifu/A2104/A210401/21008670/'
                },
                { 
                    time: "13:30", type: "SIGHT", title: "飛驒古川 瀨戶川鯉魚", sub: "你的名字 聖地巡禮",
                    address: "岐阜県飛騨市古川町", mapcode: "191 548 574*63",
                    desc: "【比高山更靜謐的白壁土藏】\n如果您喜歡電影《你的名字》，這裡絕對是必訪聖地。瀧尋找三葉的車站、圖書館都在這裡。\n\n【瀨戶川與鯉魚】\n這條流經白壁土藏街的小河川，飼養著上千條色彩斑斕的錦鯉。冬天時為了怕鯉魚凍死，居民會將牠們搬家到較溫暖的池塘，春天再搬回來，是當地特有的「鯉魚搬家」習俗。"
                },
                { time: "15:00", type: "DRIVE", title: "前往富山 (經朝日町)", desc: "車程約 2 小時", icon: "car" },
                { 
                    time: "16:30", type: "SIGHT", title: "春之四重奏 (朝日町)", sub: "季節限定絕景",
                    address: "富山県下新川郡朝日町", mapcode: "323 158 531*41",
                    desc: "【奇蹟的同框】\n這裡可以同時拍到四種顏色：\n1. 白色的北阿爾卑斯殘雪（背景）\n2. 粉紅色的舟川櫻花林\n3. 黃色的油菜花田\n4. 紅色的鬱金香花田\n\n這四種色彩在同一個畫面中綻放，是大自然最美的協奏曲。最佳觀賞期通常在4月上旬至中旬。"
                },
                { 
                    time: "19:00", type: "FOOD", title: "晚餐：白えび亭 (白蝦亭)", sub: "富山灣的寶石",
                    address: "富山県富山市明輪町1-220 (富山站內)", tel: "076-433-0355",
                    desc: "【富山灣的寶石】\n白蝦亭位於富山車站旁，最出名的就是「白蝦天丼」。\n\n每一碗天丼都鋪滿了數十隻手工剝殼的白蝦，炸得酥脆鮮甜，完全不需要沾醬就非常好吃！",
                    menu: [ { name: "白蝦天丼", jp: "白えび天丼", price: "¥1,680" }, { name: "白蝦刺身丼", jp: "白えび刺身丼", price: "¥2,980" } ],
                    tabelog: 'https://tabelog.com/toyama/A1601/A160101/16000041/'
                },
                { time: "20:00", type: "STAY", title: "Comfort Hotel Toyama", desc: "Toyama Station", address: "富山県富山市宝町1-3-2", tel: "076-433-3111", booking: "CONF#80924504", icon: "bed" }
            ]
        },
        {
            day: "Day 6", date: "4/16", weekday: "THU", location: "立山黑部",
            lat: 36.57, lon: 137.60,
            highlights: [
                { 
                    time: "07:00", type: "SIGHT", title: "立山黑部 雪之大谷", sub: "開山初期限定絕景",
                    address: "立山駅 (車停此處)", mapcode: "669 222 537*11",
                    desc: "【六種交通工具的接力賽】\n為了保護環境，私家車只能停在山下的「立山站」。接下來您將換乘纜車、高原巴士、無軌電車等 6 種交通工具，橫越阿爾卑斯山脈。\n\n【雪之大谷】\n在室堂站（海拔2450m），高原巴士會行駛在兩側高達15-20公尺的雪壁之間。您可以下車親自走在這條「雪之峽谷」中，感受大自然的震撼力。"
                },
                { 
                    time: "18:00", type: "FOOD", title: "晚餐：廻転とやま鮨", sub: "富山灣直送",
                    address: "富山県富山市桜町1-4-10", tel: "076-431-5448",
                    desc: "【迴轉壽司的頂點】\n富山的迴轉壽司水準極高！這家店強調「天然的魚塘—富山灣」直送。這裡的魚獲因為距離港口近，鮮度沒話說。\n必點富山三寶：白蝦、螢光烏賊、鰤魚（Buri）。",
                    menu: [ { name: "富山灣三種盛", jp: "富山湾三種盛り", price: "¥680" }, { name: "螢光烏賊", jp: "ホタルイカ", price: "¥380" } ],
                    tabelog: 'https://tabelog.com/toyama/A1601/A160101/16007229/'
                },
                { time: "20:00", type: "STAY", title: "Comfort Hotel Toyama", desc: "續住", booking: "CONF#80924504", icon: "bed" }
            ]
        },
        {
            day: "Day 7", date: "4/17", weekday: "FRI", location: "白川鄉/三重",
            lat: 36.25, lon: 136.90,
            highlights: [
                { 
                    time: "08:30", type: "SIGHT", title: "雨晴海岸", sub: "海越立山絕景",
                    address: "富山県高岡市太田", mapcode: "128 393 254*55",
                    desc: "【世界級奇景】\n這是世界上少數可以「隔著大海眺望3000公尺級雪山」的地方。前景是女岩與湛藍的富山灣，背景是雄偉的立山連峰，運氣好遇到晴天時，美得像一幅畫。"
                },
                { 
                    time: "11:00", type: "SIGHT", title: "白川鄉合掌村 (賞櫻)", sub: "世界遺產",
                    address: "岐阜県大野郡白川村荻町", tel: "05769-6-3111",
                    desc: "【春季限定粉色童話】\n雖然您之前可能來過，但4月中下旬的合掌村剛好是櫻花季。不同於冬天的銀白世界，粉嫩的櫻花點綴在古老的合掌造建築旁，別有一番風味。\n\n【停車導航】\n請設定導航至「村營細流停車場（せせらぎ公園駐車場）」，這是遊覽合掌村最主要的停車場，過橋即達村落。",
                    tips: "導航：村營細流停車場"
                },
                { time: "14:00", type: "DRIVE", title: "前往名花之里", desc: "經東海北陸自動車道 (約2.5hr)", icon: "car" },
                { 
                    time: "17:30", type: "SIGHT", title: "名花之里", sub: "日本最大燈海",
                    address: "三重県桑名市長島町駒江漆畑270", tel: "0594-41-0787",
                    desc: "【地上的銀河】\n這裡連續多年被評為日本必看的夜間燈飾第一名。最著名的是全長200公尺的「光之隧道」，數百萬顆暖黃色的LED燈泡將您包圍，極度浪漫。\n\n園區內的「秋海棠花園」也非常壯觀，建議購買套票進入參觀。"
                },
                { 
                    time: "20:00", type: "FOOD", title: "晚餐：山本屋本店", sub: "味噌烏龍麵",
                    address: "愛知県名古屋市中村区名駅3-12-19", tel: "052-565-0278",
                    desc: "【超硬派！名古屋名物】\n第一次吃的人可能會嚇一跳：「麵芯怎麼沒熟？」別擔心，這就是山本屋本店的特色！使用粗硬的生麵直接放入味噌高湯燉煮，口感極具嚼勁。\n\n建議搭配免費續加的漬物（白菜、蘿蔔），非常解膩。",
                    menu: [ { name: "味噌烏龍麵", jp: "味噌煮込みうどん", price: "¥1,200" } ],
                    tabelog: 'https://tabelog.com/aichi/A2301/A230103/23000122/'
                },
                { time: "21:30", type: "STAY", title: "Comfort Hotel Nagoya Fushimi", desc: "伏見站", address: "愛知県名古屋市中区錦2-19-14", tel: "052-201-3111", booking: "CONF#80924952", icon: "bed" }
            ]
        },
        {
            day: "Day 8", date: "4/18", weekday: "SAT", location: "愛知",
            lat: 35.17, lon: 137.09,
            highlights: [
                { 
                    time: "10:00", type: "SIGHT", title: "吉卜力公園", sub: "宮崎駿的夢幻世界",
                    address: "愛知県長久手市茨ケ廻間乙1533-1", 
                    desc: "【真的走進電影裡】\n吉卜力公園位於愛知縣，是將原本的「愛・地球博紀念公園」重新規劃，讓宮崎駿筆下的奇幻世界真實重現。這裡與一般主題樂園最大的不同是——沒有大型雲霄飛車，沒有人偶裝表演，主打「散步、發現、感受」。\n\n【主要區域】\n1. 吉卜力大倉庫：這是室內型的大展覽館，收藏了吉卜力作品的秘密。您可以在這裡與《神隱少女》的無臉男合照，或是看到《天空之城》巨大的機器人兵。\n\n2. 青春之丘：重現了《心之谷》中的古董店「地球屋」，站在高處可以俯瞰園區。\n\n3. Dondoko之森：以《龍貓》為主題，穿過森林步道後，會看到小月和小梅的家。\n\n這裡的每個角落都藏著細節，請放慢腳步，在森林與微風中尋找屬於您的童話回憶吧！",
                    tips: "預約號: GHP-2026-XXXX"
                },
                { 
                    time: "17:00", type: "FOOD", title: "晚餐：丸哈食堂 (まるは食堂)", sub: "特大炸蝦",
                    address: "中部國際機場內 / 或常滑本店",
                    desc: "【愛知縣民的愛】\n這家食堂以「巨無霸炸蝦」聞名，蝦肉緊實彈牙，外皮酥脆不油膩。這是在地人從小吃到大的美味，雖然價格稍高，但份量絕對對得起價格。",
                    menu: [ { name: "特大炸蝦定食", jp: "エビフライ定食", price: "¥2,200" } ],
                    tabelog: 'https://tabelog.com/aichi/A2304/A230402/23001853/'
                },
                { time: "20:00", type: "STAY", title: "Comfort Hotel Central Int Airport", desc: "機場島內", address: "愛知県常滑市セントレア4-2-3", tel: "0569-38-7211", booking: "CONF#80889756", icon: "bed" }
            ]
        },
        {
            day: "Day 9", date: "4/19", weekday: "SUN", location: "返台",
            lat: 34.86, lon: 136.81,
            highlights: [
                { 
                    time: "09:00", type: "SHOP", title: "最後採買：機場免稅店", sub: "蝦餅 / 赤福",
                    desc: "【必買伴手禮】\n1. 蝦餅之里 (えびせんべいの里)：便宜又大包，綜合口味最受歡迎。\n2. 赤福 (Akafuku)：伊勢名物，紅豆泥包麻糬，保存期限短，適合回國馬上吃。"
                },
                { 
                    time: "09:30", type: "FOOD", title: "早餐/早午餐：Kakako", sub: "名古屋早餐文化",
                    address: "愛知県名古屋市中村区名駅4-15-2 (柳橋市場店)", 
                    desc: "【紅豆吐司的極致】\n這家咖啡店位於柳橋中央市場附近，主打自家烘焙咖啡與名古屋特有的「紅豆奶油吐司」。吐司厚實鬆軟，搭配綿密的紅豆泥與現打鮮奶油，是離開名古屋前最棒的回憶。",
                    menu: [{ name: "紅豆奶油吐司", jp: "小倉トースト", price: "¥850" }],
                    tabelog: 'https://tabelog.com/aichi/A2301/A230103/23000084/' 
                },
                { 
                    time: "10:30", type: "SIGHT", title: "名古屋城 (外圍拍照)", sub: "金鯱之城",
                    address: "愛知県名古屋市中区本丸1-1",
                    desc: "【日本三大名城】\n屋頂上兩隻金色的「鯱」是名古屋的象徵。因時間有限，建議在外圍拍攝壯觀的天守閣即可，或是快速參觀修復完成的「本丸御殿」。"
                },
                { time: "11:30", type: "CAR", title: "還車：日產レンタカー", desc: "中部國際機場店", tips: "請加滿油並保留收據", icon: "corner-up-left" },
                { time: "12:20", type: "FLIGHT", title: "CI 0155 名古屋 ➔ 台北", desc: "14:30 抵達桃園 (TPE)", icon: "plane", booking: "訂位代號: FK3SJX" }
            ]
        }
    ];

    const TOOLS_DATA = {
        checklist: [
            { id: 'docs', name: '重要文件', color: 'bg-[#e3dcd2] text-[#8c7b6c]', items: [ { id: 'check_doc_passport', label: '護照' }, { id: 'check_doc_money', label: '日幣現金' }, { id: 'check_doc_vjw', label: '信用卡' }, { id: 'check_doc_ticket', label: '保險單' } ] },
            { id: 'tech', name: '3C 產品', color: 'bg-[#d6e0e2] text-[#5c7a80]', items: [ { id: 'check_3c_phone', label: '網卡/漫遊' }, { id: 'check_3c_charge', label: '充電線' }, { id: 'check_3c_bank', label: '行動電源' } ] },
            { id: 'personal', name: '個人/盥洗', color: 'bg-[#dbe4d5] text-[#6b8063]', items: [ { id: 'check_item_rain', label: '雨具' }, { id: 'check_item_coat', label: '保暖衣物' }, { id: 'check_item_wash', label: '牙刷/洗面乳' }, { id: 'check_item_meds', label: '常備藥' } ] }
        ],
        daily: [ { id: 'daily_charger', label: '充電器 / 轉接頭' }, { id: 'daily_wash', label: '盥洗包 / 眼鏡' }, { id: 'daily_wifi', label: '護照 / 隨身貴重物品' }, { id: 'daily_key', label: '房卡已歸還' } ],
        jp: [
            { jp: 'すみません', zh: '不好意思' }, 
            { jp: 'トイレはどこですか', zh: '廁所在哪裡' },
            { jp: '別々に包んでください', zh: '請分開包裝' }, 
            { jp: '免税になりますか', zh: '可以免稅嗎?' },
            { jp: '袋は要りません', zh: '不用袋子' }, 
            { jp: '新しいのはありますか', zh: '有新的嗎?' },
            { jp: 'これをください', zh: '我要這個' }, 
            { jp: 'カードは使えますか', zh: '可以刷卡嗎?' },
            { jp: 'メニューをください', zh: '請給我菜單' }, 
            { jp: 'お水をください', zh: '請給我水' }, 
            { jp: 'おすすめは？', zh: '有推薦的嗎?' }, 
            { jp: 'お会計をお願いします', zh: '麻煩結帳' }
        ]
    };

    const ATTRACTION_DETAILS = {
        "大須觀音 & 商店街": "大須觀音（Osu Kannon）是日本三大觀音之一，香火鼎盛。而緊鄰的「大須商店街」更是名古屋最熱鬧的購物區，有超過1200家店鋪。\n\n【商店街特色】\n1. 異國風情：這裡有來自世界各國的美食，如台灣炸雞、土耳其烤肉、巴西烤雞等。\n2. 古著與次文化：大須也被稱為「名古屋的秋葉原」，有許多動漫周邊、女僕咖啡廳以及風格獨特的二手衣店。\n3. 必吃美食：炸饅頭、鯛魚燒、糰子等邊走邊吃的銅板美食。",
        "綠洲21 & 電視塔": "綠洲21（Oasis 21）是名古屋的地標建築，最吸睛的是頂層的「水的宇宙船」。\n\n【水的宇宙船】\n這是一個巨大的橢圓形玻璃屋頂，上面鋪滿了流動的水，在陽光照射下波光粼粼。晚上點燈後，配合旁邊的名古屋電視塔（中部電力 MIRAI TOWER），呈現出極具未來感的夜景。\n\n您可以免費走上玻璃屋頂散步，是拍攝名古屋夜景的最佳地點。",
        "HARBS 本店": "HARBS 是發源於名古屋的甜點名店，以「追求心靈滿足」為宗旨。這家榮本店是所有 HARBS 的起點，氛圍優雅。\n\n【必吃：水果千層】\nHARBS 的招牌就是「Mille Crepes（水果千層蛋糕）」。六層薄餅皮夾著滿滿的當季新鮮水果（草莓、奇異果、哈密瓜、香蕉等）和特製的不甜膩鮮奶油，每一口都能吃到水果的鮮甜，份量十足卻清爽無負擔。",
        "炭焼 うな富士": "「炭焼 うな富士」是名古屋極少數獲得米其林推薦的鰻魚飯專賣店，以使用稀有的「青鰻」聞名。\n\n【青鰻的美味】\n青鰻是指背部呈現青色、腹部雪白的高品質養殖鰻魚，肉質比一般鰻魚更肥厚、油脂更豐富。店家堅持使用能夠產生高溫的備長炭，將鰻魚烤得外皮酥脆、內部軟嫩多汁。\n\n【必點：肝入りうなぎ丼】\n如果不怕內臟，強烈推薦點這道「鰻肝蓋飯」。除了滿滿的鰻魚，還放上了好幾顆烤得香氣四溢的鰻魚肝，這是數量限定的夢幻逸品！",
        "飛驒古川 瀨戶川鯉魚": "飛驒古川（Hida Furukawa）是一個比高山更寧靜、更具生活感的古老小鎮，因動畫電影《你的名字》在此取景而聲名大噪。\n\n【必看亮點】\n1. 白壁土藏街與瀨戶川：這是古川最經典的畫面。沿著清澈的瀨戶川，排列著一整排白牆黑瓦的傳統倉庫（土藏）。川裡游著上千條色彩斑斕的錦鯉，您可以購買魚飼料餵食，感受悠閒的午後時光。\n\n2. 《你的名字》聖地巡禮：\n- 飛驒古川車站：電影中瀧尋找三葉時出現的車站場景，一定要在天橋上拍一張列車進站的畫面。\n- 飛驒市圖書館：瀧在此查閱關於糸守町的資料。\n- 氣多若宮神社：電影中宮水神社的原型之一。\n\n這裡沒有高山老街的擁擠喧囂，多了一份屬於飛驒山城的靜謐與優雅。",
        "春之高山祭 (山王祭)": "春之高山祭（Spring Takayama Festival），又稱為山王祭，是日本三大美祭之一，每年固定於4月14日與15日舉行，宣告飛驒高山春天的來臨。\n\n【祭典看點】\n1. 華麗屋台：祭典的主角是12座被譽為「活動的陽明門」的屋台（花車）。這些屋台裝飾著精緻的飛驒木雕、漆器與金屬飾品，展現了江戶時代工匠的高超技藝。\n\n2. 機關人偶表演：其中幾座屋台上有精巧的「機關人偶（Karakuri）」，由多位操偶師在內部精密操控，人偶能做出變臉、寫字等高難度動作，栩栩如生，是必看重點！\n\n3. 夢幻夜祭：若天氣允許，14日晚上會舉行夜祭。每座屋台掛上約100盞燈籠，在漆黑的古老街道中巡遊，與白天華麗燦爛的氛圍截然不同，充滿了夢幻與神祕感。",
        "立山黑部雪之大谷": "立山黑部阿爾卑斯路線，是一條連接富山縣與長野縣的壯闊山岳觀光路線。為了保護自然環境，私家車禁止進入，旅客必須換乘多種獨特的交通工具才能橫越群山。這趟旅程您將體驗人類工程與大自然奇景的結合。\n\n【六種交通工具大解密】\n1. 立山登山纜車 (7分鐘)：從立山站一口氣爬升500公尺，進入山岳地帶。\n\n2. 立山高原巴士 (50分鐘)：行駛在雪壁之間，前往標高2450公尺的室堂，也就是著名的「雪之大谷」所在地。\n\n3. 立山隧道無軌電車 (10分鐘)：這是在日本海拔最高的隧道中行駛的電車，全程都在山洞裡。\n\n4. 立山架空索道 (7分鐘)：無支柱式纜車，像移動的展望台，可以360度俯瞰阿爾卑斯山脈全景。\n\n5. 黑部登山纜車 (5分鐘)：為了不破壞景觀，这是日本唯一全地下式的纜車。\n\n6. 關電隧道電氣巴士 (16分鐘)：穿越當年工程最艱鉅的破碎帶，最後抵達扇澤。",
        "名花之里 (Nabana no Sato)": "名花之里（Nabana no Sato）位於三重縣桑名市，以「日本最大規模的夜間燈飾」聞名於世。這裡的點燈活動不只是單純的掛掛燈泡，而是利用數百萬顆LED燈球，在大地上描繪出壯觀的圖畫。\n\n【必看亮點】\n1. 光之隧道：全長200公尺的光之迴廊，走在隧道中彷彿被溫暖的光芒包圍，是這裡最經典的打卡點。\n\n2. 主題燈飾區：每年會有不同的主題（如熊本熊、阿爾卑斯山的少女等），利用燈光在廣大的斜坡上演出動態的故事。\n\n3. 水上燈飾：利用寬廣的水面反射光影，創造出如同極光般夢幻的色彩變化。\n\n建議您傍晚入場，先欣賞白天的花園美景（如鬱金香），隨著夜幕低垂，見證燈光瞬間亮起的感動時刻。",
        "吉卜力公園 Ghibli Park": "吉卜力公園位於愛知縣，是將原本的「愛・地球博紀念公園」重新規劃，讓宮崎駿筆下的奇幻世界真實重現。這裡與一般主題樂園最大的不同是——沒有大型雲霄飛車，沒有人偶裝表演，主打「散步、發現、感受」。\n\n【主要區域】\n1. 吉卜力大倉庫：這是室內型的大展覽館，收藏了吉卜力作品的秘密。您可以在這裡與《神隱少女》的無臉男合照，或是看到《天空之城》巨大的機器人兵。\n\n2. 青春之丘：重現了《心之谷》中的古董店「地球屋」，站在高處可以俯瞰園區。\n\n3. Dondoko之森：以《龍貓》為主題，穿過森林步道後，會看到小月和小梅的家。\n\n這裡的每個角落都藏著細節，請放慢腳步，在森林與微風中尋找屬於您的童話回憶吧！",
        "新穗高雙層纜車": "新穗高高空纜車（Shinhotaka Ropeway）是日本唯一的雙層纜車，帶您直達標高2156公尺的雲端世界，輕鬆飽覽北阿爾卑斯山的壯麗全景。\n\n【空中漫步體驗】\n纜車分為兩段，第一段從新穗高溫泉站到鍋平高原站，第二段則是著名的雙層纜車，直達西穗高口站。隨著纜車緩緩爬升，原本仰望的群山逐漸變為平視，最後將整個槍之岳、穗高連峰踩在腳下。\n\n【山頂展望台】\n西穗高口站頂樓的展望台榮獲《米其林綠色指南》二星評價。在這裡，您可以360度無死角地欣賞綿延的雪峰與雲海。如果在冬季或春初前往，還能體驗在比人還高的「雪之迴廊」中散步的樂趣。",
        "雨晴海岸": "雨晴海岸（Amaharashi Coast）被選為「日本海濱百選」之一，位於富山縣高岡市。這裡擁有世界上極為罕見的奇景——「隔著海洋眺望3000公尺級的高山」。\n\n【絕景構圖】\n天氣晴朗時，您可以站在海邊，看著湛藍的富山灣，而海平面的對岸竟然矗立著終年積雪的立山連峰！前景著名的「女岩」與後方雄偉的雪山相互輝映，彷彿一幅潑墨山水畫。\n\n【義經岩傳說】\n海岸邊有一塊巨大的岩石叫做「義經岩」。傳說源義經在被哥哥源賴朝追殺逃亡至北陸時，曾在此岩石下躲避驟雨等待天晴，這也是「雨晴」地名的由來。",
        "高遠城址公園": "高遠城址公園（Takato Castle Ruins Park）是日本賞櫻名所百選之一，更有「天下第一櫻」的美譽。\n\n【高遠小彼岸櫻】\n這裡種植了約1500棵特有的「高遠小彼岸櫻」，這種櫻花比染井吉野櫻稍小，顏色則更為紅潤。盛開時，整個公園彷彿被粉紅色的雲海覆蓋，與遠處殘雪的中央阿爾卑斯山形成絕美對比。\n\n【櫻雲橋】\n公園內最著名的景點是「櫻雲橋」，櫻花倒映在橋下的水池中，是攝影師必拍的畫面。",
        "奈良井宿": "奈良井宿（Narai-juku）是中山道六十九次中，位於木曾路最北端的宿場，也是保存最完整的宿場之一。\n\n【奈良井千軒】\n因為要翻越險峻的鳥居峠，許多旅人都會在此留宿，昔日繁榮的景象被稱為「奈良井千軒」。\n\n【時光隧道】\n這裡保留了江戶時代長達一公里的古老街道，兩旁是傳統的木造建築，完全沒有現代化的電線桿。走在其中彷彿穿越時空。必看地標是巨大的「木曾大橋」，由樹齡超過200年的檜木建成。",
        "馬籠宿": "馬籠宿是江戶時代連接東京與京都的「中山道」上的第43個宿場町（驛站）。\n\n【石板坡道】\n與其他宿場不同，馬籠宿是沿著陡峭的山坡而建。走在蜿蜒的石板路上，兩旁是保留完整的江戶時代木造建築，彷彿穿越時空。\n\n【必吃：五平餅】\n這是一種將米飯搗碎後裹在木串上，塗上核桃味噌醬炭烤的鄉土料理，香氣撲鼻。",
        "妻籠宿": "妻籠宿是日本第一個「重要傳統建造物群保存地區」。當地的居民發起了「不賣、不租、不拆」的運動，才得以將這份珍貴的遺產完整保留下來。\n\n【原汁原味】\n相比馬籠宿，這裡更顯質樸與寧靜。這裡完全看不到電線桿和現代招牌，完整重現了幾百年前江戶時代的街道風貌。建議可以參觀「脇本陣奧谷」，感受當年大名（諸侯）住宿的奢華。",
        "國寶 松本城": "松本城是日本現存最古老的五重六階木造天守閣，與姬路城、彥根城等並列為日本國寶。\n\n【烏城之美】\n不同於姬路城的白色，松本城的外牆塗滿了黑漆，因此被稱為「烏城」。黑色的城堡在北阿爾卑斯雪山的映襯下，顯得格外莊嚴肅穆。\n\n【建築特色】\n天守閣內部保留了戰國時代的結構，樓梯非常陡峭（最大斜度約61度），攀爬時請務必小心。",
        "春之四重奏 (朝日町)": "春之四重奏（Spring Quartet）是富山縣朝日町春季限定的絕景。\n\n【四重奏的組成】\n1. 白色的北阿爾卑斯殘雪（背景）\n2. 粉紅色的舟川櫻花林\n3. 黃色的油菜花田\n4. 紅色的鬱金香花田\n\n這四種色彩在同一個畫面中綻放，是大自然最美的協奏曲。最佳觀賞期通常在4月上旬至中旬。",
        "名古屋城 (外圍拍照)": "名古屋城由德川家康下令建造，是日本三大名城之一。\n\n【金鯱】\n天守閣屋頂上有一對金色的「鯱（Shachihoko）」，是名古屋的象徵，代表著德川家的威嚴。\n\n【本丸御殿】\n雖然天守閣目前因耐震工程關閉中（可能僅能外觀拍照），但修復完成的「本丸御殿」內部金碧輝煌，屏風壁畫極盡奢華，非常值得入內參觀。",
        "白川鄉合掌村 (賞櫻)": "白川鄉（Shirakawa-go）是世界文化遺產，以獨特的「合掌造」建築聞名。\n\n【春季限定】\n雖然您可能在冬天來過，但4月中下旬的合掌村是櫻花的季節！不同於冬天的銀白蕭瑟，春天的合掌村被粉嫩的櫻花點綴，搭配綠油油的稻田與古老建築，彷彿走進了童話世界。\n\n【必看點】\n1. 明善寺庫裡：這是村內最大的合掌造建築，櫻花與鐘樓的合影是經典畫面。\n2. 城山天守閣展望台：可以俯瞰整個荻町合掌聚落的全景，春天時山坡上也會有櫻花盛開。"
    };

    // ---------------------------------------------------------
    // 2. HELPER FUNCTIONS
    // ---------------------------------------------------------
    function initDynamicPadding() {
        const header = document.getElementById('header');
        const main = document.getElementById('main-container');
        if(header && main) {
            const h = header.offsetHeight;
            main.style.paddingTop = (h + 20) + 'px';
        }
    }
    
    // Switch UI - Moved here to ensure it's defined
    function switchTab(tabName) {
        if(tabName === 'itinerary') renderItinerary();
        else if(tabName === 'hotels') renderHotels();
        else if(tabName === 'drive') renderDrive();
        else if(tabName === 'tools') renderTools();
        
        ['itinerary', 'hotels', 'drive', 'tools'].forEach(t => {
            const btn = document.getElementById('nav-'+t);
            if(t === tabName) btn.classList.add('active');
            else btn.classList.remove('active');
        });
        
        // Hide/Show Date Selector
        const daySelector = document.getElementById('day-selector');
        if (tabName === 'itinerary') {
            daySelector.classList.remove('hidden');
            daySelector.classList.add('flex');
            document.getElementById('header').classList.add('pb-2');
            document.getElementById('header').classList.remove('pb-6');
        } else {
            daySelector.classList.add('hidden');
            daySelector.classList.remove('flex');
            document.getElementById('header').classList.remove('pb-2');
            document.getElementById('header').classList.add('pb-6');
        }

        window.scrollTo(0,0);
    }
    
    function getIcon(t) { 
        if(t==='FLIGHT') return 'plane'; 
        if(t==='CAR'||t==='DRIVE') return 'car'; 
        if(t==='FOOD') return 'utensils'; 
        if(t==='STAY') return 'bed-double'; 
        if(t==='SHOP') return 'shopping-bag'; 
        return 'map-pin'; 
    }

    function getIntVal(id, def = 1) {
        const el = document.getElementById(id);
        const val = el ? el.value : null;
        return val ? parseInt(val) : def;
    }

    // --- Weather Helpers ---
    async function fetchDayWeather(day) {
        const el = document.getElementById('day-weather');
        if(!el) return;
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${day.lat}&longitude=${day.lon}&daily=precipitation_probability_max,temperature_2m_max,temperature_2m_min,uv_index_max,weather_code&timezone=Asia%2FTokyo&forecast_days=1`);
            const d = await res.json();
            
            let aqi = '-';
            try {
                const aqiRes = await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${day.lat}&longitude=${day.lon}&daily=us_aqi_max&timezone=Asia%2FTokyo&forecast_days=1`);
                const aqiData = await aqiRes.json();
                if(aqiData.daily && aqiData.daily.us_aqi_max) aqi = aqiData.daily.us_aqi_max[0];
            } catch(e){}

            if(d.daily) {
                const max = Math.round(d.daily.temperature_2m_max[0]);
                const min = Math.round(d.daily.temperature_2m_min[0]);
                const rain = d.daily.precipitation_probability_max[0];
                const code = d.daily.weather_code[0];

                let wIcon = '<i data-lucide="sun" class="w-8 h-8 text-orange-400"></i>';
                if(code>3) wIcon = '<i data-lucide="cloud" class="w-8 h-8 text-stone-400"></i>';
                if(code>=51) wIcon = '<i data-lucide="cloud-rain" class="w-8 h-8 text-blue-400"></i>';

                el.innerHTML = `
                    <div class="flex items-center justify-end gap-3">
                        <div class="text-right">
                            <div class="text-xl font-bold text-stone-800 leading-none">${max}° <span class="text-sm text-stone-400 font-normal">/ ${min}°</span></div>
                            <div class="flex items-center justify-end gap-2 mt-1 text-[10px] text-stone-500">
                                <span><i data-lucide="umbrella" class="w-3 h-3 inline"></i> ${rain}%</span>
                                <span>AQI ${aqi}</span>
                            </div>
                        </div>
                        ${wIcon}
                    </div>
                `;
                lucide.createIcons();
            }
        } catch(e) {
            el.innerHTML = '<span class="text-xs text-stone-300">Weather Unavailable</span>';
        }
    }
    
    function fetchLocalWeather() {
        const tempEl = document.getElementById('local-temp');
        if(!tempEl) return;
        if(navigator.geolocation) {
            tempEl.innerText = '...';
            navigator.geolocation.getCurrentPosition(async p => {
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current=temperature_2m&timezone=auto`);
                    const d = await res.json();
                    if(d.current) tempEl.innerText = Math.round(d.current.temperature_2m) + '°';
                } catch(e) { tempEl.innerText = '--'; }
            }, () => tempEl.innerText = '--');
        }
    }

    // --- Currency Logic ---
    let currentRate = 0.22;
    async function fetchRate() {
        try {
            const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
            const data = await res.json();
            if(data.rates.TWD) {
                currentRate = data.rates.TWD;
                // Only try to update UI if element exists (Tools tab is active)
                const rateDisplay = document.getElementById('calc-rate-display');
                if(rateDisplay) {
                    rateDisplay.innerText = currentRate.toFixed(3);
                    renderBudget();
                    convertCurrency();
                }
            }
        } catch(e){ console.log("Rate Fetch Error", e); }
    }
    
function convertCurrency() {
        // 這裡的 ID 必須跟上面 HTML 裡的 id="calc-jpy" 對應
        const jpyInput = document.getElementById('calc-jpy'); 
        const twdOutput = document.getElementById('calc-twd');
        
        if(jpyInput && twdOutput) {
            const jpy = parseFloat(jpyInput.value);
            
            if(!isNaN(jpy)) {
                // currentRate 是全域變數，會由 fetchRate() 自動更新
                twdOutput.innerText = Math.round(jpy * currentRate).toLocaleString();
            } else {
                twdOutput.innerText = '0';
            }
        }
    }

    // --- Budget / Batch Logic ---
    let budgetItems = JSON.parse(localStorage.getItem('trip_budget') || '[]');
    let batchItems = []; 

    function renderBudget() {
        const list = document.getElementById('budget-list');
        if(!list) return; // Exit if tools tab not active
        
        list.innerHTML = ''; 
        let total = 0;
        budgetItems.forEach((item, index) => {
            const qty = item.qty || 1;
            const rowTotal = item.price * qty;
            total += rowTotal;
            list.innerHTML += `<li class="flex justify-between items-center border-b border-gray-50 dark:border-gray-700 pb-1">
                <span class="text-gray-600 dark:text-gray-300">${item.name} <span class="text-xs text-gray-400">x${qty}</span></span>
                <div class="flex items-center gap-2">
                    <span class="font-medium text-gray-800 dark:text-gray-200">¥${rowTotal.toLocaleString()}</span>
                    <button onclick="deleteItem(${index})" class="text-gray-300 hover:text-red-400"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                </div>
            </li>`;
        });
        
        const totalJpy = document.getElementById('total-jpy');
        const totalTwd = document.getElementById('total-twd');
        if(totalJpy) totalJpy.innerText = '¥' + total.toLocaleString();
        if(totalTwd) totalTwd.innerText = '≈ NT$ ' + Math.round(total * currentRate).toLocaleString();
        
        try { localStorage.setItem('trip_budget', JSON.stringify(budgetItems)); } catch(e) {}
        lucide.createIcons();
    }

    function addItem() {
        const name = document.getElementById('budget-name').value;
        const price = parseInt(document.getElementById('budget-price').value);
        const qty = getIntVal('budget-qty', 1);
        if (name && price) { 
            budgetItems.push({ name, price, qty }); 
            document.getElementById('budget-name').value = ''; 
            document.getElementById('budget-price').value = ''; 
            document.getElementById('budget-qty').value = '1'; 
            renderBudget(); 
        }
    }
    
    function deleteItem(idx) { budgetItems.splice(idx, 1); renderBudget(); }
    function resetBudget() { if(confirm('清空記帳？')) { budgetItems = []; renderBudget(); } }

    // Batch specific
    function addBatchItem() {
        const name = document.getElementById('batch-name').value;
        const price = parseInt(document.getElementById('batch-price').value);
        const qty = getIntVal('batch-qty', 1);
        if(name && price) {
            batchItems.push({name, price, qty});
            document.getElementById('batch-name').value = '';
            document.getElementById('batch-price').value = '';
            document.getElementById('batch-qty').value = '1';
            renderBatch();
        }
    }
    
    function renderBatch() {
        const list = document.getElementById('batch-list');
        if(!list) return;
        
        const total = batchItems.reduce((a, b) => a + (b.price * b.qty), 0);
        list.classList.remove('hidden');
        list.innerHTML = batchItems.map((i, idx) => `
            <div class="flex justify-between text-xs text-stone-600 mb-1 border-b border-stone-100 pb-1">
                <span>${i.name} x${i.qty}</span>
                <div class="flex gap-2"><span>¥${(i.price*i.qty).toLocaleString()}</span><button onclick="delBatch(${idx})" class="text-red-400">×</button></div>
            </div>`).join('');
            
        document.getElementById('batch-total').innerText = '¥' + total.toLocaleString();
        
        const pct = Math.min((total / 5500) * 100, 100);
        const bar = document.getElementById('batch-progress');
        if(bar) {
            bar.style.width = pct + '%';
            const status = document.getElementById('batch-status');
            if(total >= 5500) {
                bar.classList.replace('bg-[#b08d76]', 'bg-green-500');
                status.innerHTML = '<span class="text-green-600">✨ 恭喜達標！可免稅</span>';
            } else {
                bar.classList.replace('bg-green-500', 'bg-[#b08d76]');
                status.innerText = `還差 ¥${(5500-total).toLocaleString()}`;
            }
        }
        lucide.createIcons();
    }
    
    function delBatch(idx) { batchItems.splice(idx, 1); renderBatch(); }
    function resetBatch() { batchItems = []; renderBatch(); document.getElementById('batch-list').classList.add('hidden'); }
    function saveBatch() {
        if(batchItems.length===0) return;
        if(confirm('存入購物記帳？')) {
            const newItems = batchItems.map(i => ({ name: `[免稅] ${i.name}`, price: i.price, qty: i.qty }));
            budgetItems = [...budgetItems, ...newItems];
            resetBatch();
            renderBudget(); 
            alert('已存入');
        }
    }

    // --- Checklist ---
    function initChecklist() {
        document.querySelectorAll('input[type="checkbox"]').forEach(e=>{ 
            if(localStorage.getItem(e.id)==='true') e.checked=true; 
        });
    }
    function saveCheck(id) { 
        localStorage.setItem(id, document.getElementById(id).checked); 
    }
    function resetDaily() { 
        document.querySelectorAll('[id^="daily_"]').forEach(e=>{
            e.checked=false; 
            localStorage.setItem(e.id,'false');
        }); 
    }

    // --- UI/Modal ---
    let activeDayIdx = 0;

    function renderDaySelector() {
        const el = document.getElementById('day-selector');
        el.innerHTML = TRIP_DATA.map((d, i) => `
            <button onclick="setDay(${i})" class="flex-shrink-0 flex flex-col items-center group transition-all duration-300 ${i === activeDayIdx ? 'opacity-100 scale-110' : 'opacity-40 scale-100'}">
                <span class="text-[10px] font-bold tracking-widest mb-1 ${i === activeDayIdx ? 'text-[#b08d76]' : 'text-stone-400'}">${d.weekday}</span>
                <div class="w-12 h-12 rounded-full flex items-center justify-center border transition-all ${i === activeDayIdx ? 'bg-[#2c2c2c] text-[#f9f8f6] border-[#2c2c2c] shadow-lg' : 'bg-white text-stone-400 border-stone-200'}">
                    <span class="font-serif text-lg font-bold">${d.date.split('/')[1]}</span>
                </div>
            </button>
        `).join('');
    }
    function setDay(idx) { activeDayIdx = idx; renderDaySelector(); renderItinerary(); }

    function openModal(index) {
        currentModalData = TRIP_DATA[activeDayIdx].highlights[index];
        const data = currentModalData;
        const modal = document.getElementById('detail-modal');
        const content = document.getElementById('modal-content');
        const backdrop = document.getElementById('modal-backdrop');
        const panel = document.getElementById('modal-panel');

        // Render booking content safely
        const bookingContent = data.booking ? `🔖 ${data.booking}` : '';
        const bookingSection = (data.link && data.booking) 
            ? `<a href="${data.link}" target="_blank" class="block w-full text-center py-3 bg-[#b83838] text-white rounded-xl font-bold mb-4 shadow-md active:scale-95 transition-transform flex items-center justify-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i> ${data.booking} (點擊開啟)</a>`
            : data.booking 
                ? `<div class="p-3 bg-stone-100 rounded-lg text-center font-mono text-stone-600 mb-6 font-bold tracking-wider">${bookingContent}</div>` 
                : '';

        let html = `
            <div class="mb-5">
                <span class="text-[10px] font-bold tracking-widest uppercase bg-stone-100 px-2 py-1 rounded text-stone-500">${data.type}</span>
                <h2 class="text-2xl font-serif font-bold text-stone-800 mt-2">${data.title}</h2>
                ${data.sub ? `<p class="text-sm text-[#b08d76] font-medium mt-1">${data.sub}</p>` : ''}
            </div>

            ${bookingSection}

            <div class="bg-[#f9f8f6] rounded-xl p-4 mb-6 space-y-3">
                ${data.address ? `<div class="flex gap-3 text-sm text-stone-600"><i data-lucide="map-pin" class="w-4 h-4 mt-0.5 flex-shrink-0 text-stone-400"></i> ${data.address}</div>` : ''}
                ${data.mapcode ? `<div class="flex gap-3 text-sm text-stone-600"><i data-lucide="navigation" class="w-4 h-4 mt-0.5 flex-shrink-0 text-stone-400"></i> MapCode: <span class="font-mono font-bold">${data.mapcode}</span></div>` : ''}
                ${data.tel ? `<div class="flex gap-3 text-sm text-stone-600"><i data-lucide="phone" class="w-4 h-4 mt-0.5 flex-shrink-0 text-stone-400"></i> 車機導航電話: <span class="font-mono font-bold">${data.tel}</span></div>` : ''}
            </div>

            ${data.desc ? `<div class="mb-8"><h4 class="font-bold text-stone-800 text-sm mb-3 flex items-center gap-2"><i data-lucide="book-open" class="w-4 h-4 text-[#b08d76]"></i> 關於此處</h4><p class="text-sm text-stone-600 leading-loose text-justify whitespace-pre-line font-light">${data.desc}</p></div>` : ''}

            ${data.speak ? `<div class="mb-8"><h4 class="font-bold text-stone-800 text-sm mb-3 flex items-center gap-2"><i data-lucide="languages" class="w-4 h-4 text-[#b08d76]"></i> 指差會話</h4><div class="grid grid-cols-2 gap-3">${data.speak.map(s => `<button onclick="speakJp('${s.jp}')" class="p-3 bg-white border border-stone-200 rounded-xl text-left active:bg-stone-50 transition"><div class="text-[10px] text-stone-400 mb-1">${s.label}</div><div class="font-bold text-stone-800 text-sm jp-font">${s.jp}</div></button>`).join('')}</div></div>` : ''}
            
            ${data.menu ? `<div class="mb-20"><h4 class="font-bold text-stone-800 text-sm mb-3 flex items-center gap-2"><i data-lucide="utensils" class="w-4 h-4 text-[#b08d76]"></i> 必點推薦 (點擊放大)</h4><div class="space-y-2">${data.menu.map(m => `<div onclick="showBigCard('${m.name}','${m.jp}')" class="flex justify-between items-center p-3 bg-white border border-stone-100 rounded-xl cursor-pointer hover:border-[#b08d76] shadow-sm"><div><div class="font-bold text-stone-800">${m.name}</div><div class="text-xs text-stone-400">${m.jp}</div></div><span class="text-sm font-mono text-[#b08d76]">${m.price}</span></div>`).join('')}</div></div>` : ''}
            
            ${data.tabelog ? `<a href="${data.tabelog}" target="_blank" class="block w-full text-center py-3 bg-[#b83838] text-white rounded-xl font-bold mb-4">Tabelog 預約 / 資訊</a>` : ''}
            
            ${data.link ? `<a href="${data.link}" target="_blank" class="block w-full text-center py-3 bg-blue-600 text-white rounded-xl font-bold mb-4">開啟預約網頁</a>` : ''}
        `;

        content.innerHTML = html;
        modal.classList.remove('hidden');
        lucide.createIcons();
        setTimeout(() => { backdrop.classList.remove('opacity-0'); panel.classList.remove('translate-y-full'); }, 10);
    }
    
    function closeModal() {
        const modal = document.getElementById('detail-modal');
        const backdrop = document.getElementById('modal-backdrop');
        const panel = document.getElementById('modal-panel');
        
        backdrop.classList.add('opacity-0');
        panel.classList.add('translate-y-full');
        setTimeout(() => { modal.classList.add('hidden'); }, 300);
    }
    
    // --- Helpers ---
    function openMap() { 
        if(!currentModalData) return; 
        const q = currentModalData.mapcode || currentModalData.address || currentModalData.title;
        window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`, '_blank');
    }
    function showBigCard(zh, jp) {
        document.getElementById('big-card-jp').innerText = jp;
        document.getElementById('big-card-zh').innerText = zh;
        document.getElementById('big-card-modal').classList.remove('hidden');
    }
    function closeBigCard() { document.getElementById('big-card-modal').classList.add('hidden'); }

    function speakJp(text) {
        if ('speechSynthesis' in window) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ja-JP'; u.rate = 0.9;
            window.speechSynthesis.speak(u);
        }
    }

    // --- Render Pages ---
    function renderItinerary() {
        const day = TRIP_DATA[activeDayIdx];
        const container = document.getElementById('main-container');
        
        setTimeout(() => fetchDayWeather(day), 50);

        container.innerHTML = `
            <div class="animate-in pb-20">
                <!-- VJW Card -->
                ${day.date === '4/11' ? `
                <div class="bg-[#2c2c2c] rounded-2xl p-5 mb-8 shadow-xl relative overflow-hidden group cursor-pointer" onclick="window.open('https://vjw-lp.digital.go.jp/zh-hant/', '_blank')">
                    <div class="absolute right-[-20px] top-[-20px] w-24 h-24 bg-[#b08d76] rounded-full opacity-20 group-hover:scale-150 transition-transform duration-500"></div>
                    <p class="text-[10px] text-[#b08d76] font-bold tracking-[0.2em] uppercase mb-2">Must Have</p>
                    <h3 class="text-xl font-serif text-white font-bold mb-1">Visit Japan Web</h3>
                    <p class="text-xs text-stone-400 font-light">入境審查 & 海關申報 QR Code</p>
                    <i data-lucide="external-link" class="absolute right-5 bottom-5 text-white/50 w-5 h-5"></i>
                </div>` : ''}

                <!-- Date Header -->
                <div class="flex items-baseline justify-between mb-2 px-2">
                    <h2 class="text-3xl font-serif font-bold text-stone-800">${day.location} <span class="text-lg text-stone-400 font-normal">Trip</span></h2>
                    <span class="text-xs font-bold text-stone-400 tracking-widest">${day.day}</span>
                </div>
                
                <div id="day-weather" class="mb-6 px-2 text-right min-h-[20px]"><span class="text-xs text-stone-300">Loading...</span></div>

                <!-- Timeline -->
                <div class="relative space-y-8 pl-4">
                    <div class="timeline-line"></div>
                    
                    ${day.highlights.map((item, i) => `
                        <div class="relative pl-8 ${i === day.highlights.length - 1 ? 'last-item' : ''}">
                            <div class="absolute left-0 top-0 flex flex-col items-center w-12">
                                <span class="text-xs font-bold text-stone-400 mb-1 font-mono">${item.time}</span>
                                <div class="w-3 h-3 rounded-full border-2 border-[#f9f8f6] shadow-sm z-10 ${item.type === 'FOOD' ? 'bg-[#b08d76]' : 'bg-[#2c2c2c]'}"></div>
                            </div>

                            <div class="bg-white rounded-2xl p-5 soft-shadow active:scale-[0.98] transition-transform cursor-pointer border border-transparent hover:border-stone-100" onclick='openModal(${i})'>
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <span class="text-[9px] font-bold tracking-wider uppercase ${item.type === 'FOOD' ? 'text-[#b08d76]' : 'text-stone-400'} mb-1 block">${item.type}</span>
                                        <h3 class="text-lg font-bold text-stone-800 leading-tight">${item.title}</h3>
                                    </div>
                                    <div class="w-8 h-8 rounded-full bg-[#f9f8f6] flex items-center justify-center text-stone-400">
                                        <i data-lucide="${item.icon || getIcon(item.type)}" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                ${item.link && item.booking 
                                    ? `<div class="mb-2 inline-flex items-center gap-1 bg-stone-100 px-2 py-1 rounded text-[10px] font-mono text-stone-600 border border-stone-200 shadow-sm"><i data-lucide="link" class="w-3 h-3"></i> ${item.booking}</div>`
                                    : item.booking 
                                        ? `<div class="mb-2 inline-flex items-center gap-1 bg-stone-100 px-2 py-1 rounded text-[10px] font-mono text-stone-600">🔖 ${item.booking}</div>` 
                                        : ''}
                                ${item.tips ? `<div class="mb-2 inline-flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded text-[10px] font-mono text-yellow-700">💡 ${item.tips}</div>` : ''}
                                ${item.sub ? `<p class="text-sm text-[#b08d76] font-medium mb-1">${item.sub}</p>` : ''}
                                <p class="text-xs text-stone-500 leading-relaxed line-clamp-2">${item.desc}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        lucide.createIcons();
    }

    function renderHotels() {
        const uniqueHotels = [];
        const seen = new Set();
        TRIP_DATA.forEach(day => {
            day.highlights.forEach(h => {
                if(h.type === 'STAY') {
                    const key = h.booking || h.title;
                    if(!seen.has(key)) { seen.add(key); uniqueHotels.push({...h, date:day.date}); }
                }
            });
        });
        
        document.getElementById('main-container').innerHTML = `
            <div class="animate-in pb-20 space-y-5">
                <h2 class="text-2xl font-serif font-bold text-stone-800 mb-6 px-1">住宿列表</h2>
                ${uniqueHotels.map(h => `
                    <div class="magazine-card p-6 flex flex-col gap-3 shadow-sm bg-white rounded-2xl border border-stone-100">
                        <div>
                            <span class="text-[10px] font-bold tracking-widest text-[#b08d76] bg-[#f0ebe7] px-2 py-0.5 rounded mb-2 inline-block">Check-in: ${h.date}</span>
                            <h3 class="font-serif font-bold text-lg text-stone-800 leading-snug">${h.title.replace('Check-in: ', '')}</h3>
                            <p class="text-xs text-stone-400 mt-1 font-mono tracking-wider uppercase">${h.desc}</p>
                        </div>
                        <div class="bg-[#fcfbf9] border border-[#f0f0f0] p-3 rounded text-center">
                            <p class="text-xs text-stone-400 uppercase tracking-widest mb-1">確認編號</p>
                            <p class="font-mono font-bold text-stone-700 tracking-wider text-lg">${h.booking || 'N/A'}</p>
                        </div>
                        <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.address || h.title)}', '_blank')" class="w-full mt-1 py-3 border border-stone-200 text-stone-600 text-xs font-bold uppercase tracking-widest rounded hover:bg-stone-800 hover:text-white transition-colors">導航飯店</button>
                    </div>
                `).join('')}
            </div>`;
        lucide.createIcons();
    }

function renderDrive() {
        document.getElementById('main-container').innerHTML = `
            <div class="animate-in pb-20 space-y-5">
                <h2 class="text-2xl font-serif font-bold text-stone-800 mb-6 px-1">自駕指南</h2>
                
                <div class="grid grid-cols-2 gap-3 mb-2">
                    <a href="https://www.google.com/maps/search/?api=1&query=駐車場" target="_blank" class="flex items-center gap-3 p-4 bg-white border border-stone-200 rounded-2xl shadow-sm active:scale-95 transition-transform hover:bg-blue-50 hover:border-blue-200 group">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-200">
                            <i data-lucide="circle-parking" class="w-5 h-5"></i>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-bold text-stone-700">找停車場</span>
                            <span class="text-[10px] text-stone-400">Parking</span>
                        </div>
                    </a>

                    <a href="https://www.google.com/maps/search/?api=1&query=ガソリンスタンド" target="_blank" class="flex items-center gap-3 p-4 bg-white border border-stone-200 rounded-2xl shadow-sm active:scale-95 transition-transform hover:bg-red-50 hover:border-red-200 group">
                        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 group-hover:bg-red-200">
                            <i data-lucide="fuel" class="w-5 h-5"></i>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-bold text-stone-700">找加油站</span>
                            <span class="text-[10px] text-stone-400">Gas Station</span>
                        </div>
                    </a>

                    <a href="https://www.google.com/maps/search/?api=1&query=コンビニ" target="_blank" class="flex items-center gap-3 p-4 bg-white border border-stone-200 rounded-2xl shadow-sm active:scale-95 transition-transform hover:bg-green-50 hover:border-green-200 group">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 group-hover:bg-green-200">
                            <i data-lucide="store" class="w-5 h-5"></i>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-bold text-stone-700">找超商/廁所</span>
                            <span class="text-[10px] text-stone-400">Conv. Store</span>
                        </div>
                    </a>

                    <a href="https://www.google.com/maps/search/?api=1&query=道の駅" target="_blank" class="flex items-center gap-3 p-4 bg-white border border-stone-200 rounded-2xl shadow-sm active:scale-95 transition-transform hover:bg-orange-50 hover:border-orange-200 group">
                        <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 group-hover:bg-orange-200">
                            <i data-lucide="coffee" class="w-5 h-5"></i>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-bold text-stone-700">找休息站</span>
                            <span class="text-[10px] text-stone-400">Michi-no-Eki</span>
                        </div>
                    </a>
                </div>
                
                <a href="https://www.google.com/maps/search/?api=1&query=ドラッグストア" target="_blank" class="w-full mb-6 flex items-center justify-center gap-2 py-3 bg-stone-100 rounded-xl text-xs font-bold text-stone-500 hover:bg-stone-200 active:scale-95 transition-transform">
                    <i data-lucide="pill" class="w-4 h-4"></i> 搜尋附近的藥妝店 (Drug Store)
                </a>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-stone-800 flex items-center gap-2"><i data-lucide="fuel" class="w-5 h-5 text-[#b08d76]"></i> 即時油價 (參考)</h4>
                        <a href="https://gogo.gs/" target="_blank" class="text-[10px] text-stone-400 underline flex items-center gap-1">gogo.gs 查價 <i data-lucide="external-link" class="w-3 h-3"></i></a>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-[#ffebee] border border-red-100 p-3 rounded-xl text-center">
                            <p class="text-[10px] text-red-400 font-bold mb-1">Regular</p>
                            <p class="text-xl font-serif font-bold text-red-600">170<span class="text-xs">円</span></p>
                            <p class="text-[9px] text-red-300 mt-1">紅色油槍</p>
                        </div>
                        <div class="bg-[#fff8e1] border border-yellow-100 p-3 rounded-xl text-center">
                            <p class="text-[10px] text-yellow-500 font-bold mb-1">High Octane</p>
                            <p class="text-xl font-serif font-bold text-yellow-600">181<span class="text-xs">円</span></p>
                            <p class="text-[9px] text-yellow-400 mt-1">黃色油槍</p>
                        </div>
                        <div class="bg-[#e8f5e9] border border-green-100 p-3 rounded-xl text-center">
                            <p class="text-[10px] text-green-500 font-bold mb-1">Diesel</p>
                            <p class="text-xl font-serif font-bold text-green-600">148<span class="text-xs">円</span></p>
                            <p class="text-[9px] text-green-400 mt-1">綠色油槍</p>
                        </div>
                    </div>
                    <p class="text-[10px] text-stone-400 mt-2 text-center">*價格僅供參考，請以當地加油站為準</p>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="bg-[#fbe9e7] p-3 rounded-full"><i data-lucide="alert-triangle" class="w-6 h-6 text-[#b85c38]"></i></div>
                        <div><h4 class="font-bold text-stone-800">立山黑部停車 (4/16)</h4><p class="text-sm text-stone-500 font-light mt-1">請導航至「立山站」大型免費停車場。建議早上 7:00 前抵達。</p></div>
                    </div>
                </div>
            </div>`;
        lucide.createIcons();
    }

    function renderTools() {
        document.getElementById('main-container').innerHTML = `
            <div class="animate-in pb-20 space-y-8">
                <!-- Checklist -->
                <section>
                    <h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest mb-4 px-1">檢查清單</h3>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100 space-y-6">
                        ${TOOLS_DATA.checklist.map(cat => `
                            <div>
                                <span class="${cat.color} text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider mb-2 inline-block">${cat.name}</span>
                                <div class="grid grid-cols-2 gap-3 mt-2">
                                    ${cat.items.map(item => `
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="${item.id}" onchange="saveCheck(this.id)" class="hidden">
                                            <div class="w-4 h-4 rounded-full border border-stone-300 flex items-center justify-center bg-white"><i data-lucide="check" class="w-2.5 h-2.5 text-white check-icon"></i></div>
                                            <span class="text-xs font-medium text-stone-600 select-none">${item.label}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                        <div class="pt-4 border-t border-stone-100">
                            <div class="flex justify-between items-center mb-3"><span class="text-xs font-bold text-stone-800">每日退房檢查</span><button onclick="resetDaily()" class="text-[10px] text-stone-400 underline">重置</button></div>
                            <div class="space-y-3">
                                ${TOOLS_DATA.daily.map(item => `
                                    <label class="w-full flex items-center gap-3 cursor-pointer">
                                        <input type="checkbox" id="${item.id}" onchange="saveCheck(this.id)" class="hidden">
                                        <div class="w-4 h-4 rounded border border-stone-300 flex items-center justify-center bg-white"><i data-lucide="check" class="w-3 h-3 text-white check-icon"></i></div>
                                        <span class="text-sm text-stone-600 font-light select-none">${item.label}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Phrases -->
                <section>
                    <h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest mb-4 px-1">手指日語</h3>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100 grid grid-cols-2 gap-3">
                        ${TOOLS_DATA.jp.map(p => `
                            <button onclick="speakJp('${p.jp}')" class="p-4 bg-[#f9f9f9] border border-stone-100 rounded-xl text-left hover:border-stone-300 transition-colors flex flex-col justify-center h-24 shadow-sm active:scale-95">
                                <div class="text-xs text-stone-400 font-bold mb-2">${p.zh}</div>
                                <div class="font-serif font-bold text-stone-800 text-xl leading-snug jp-font">${p.jp}</div>
                            </button>
                        `).join('')}
                    </div>
                </section>

                <!-- Emergency -->
                <section>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-red-100 flex justify-between items-center bg-[#fdf2f2] mb-4">
                        <div><h3 class="font-bold text-stone-800">緊急聯絡</h3><p class="text-xs text-stone-500 mt-1">警察 110 / 救護車 119</p></div>
                        <div class="flex gap-2">
                            <a href="tel:110" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-red-500 font-bold shadow-sm">110</a>
                            <a href="tel:119" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-red-500 font-bold shadow-sm">119</a>
                        </div>
                    </div>

                    <!-- JNTO -->
                    <div class="p-3 bg-stone-50 rounded-xl flex justify-between items-center mb-2">
                        <div>
                            <p class="text-xs text-stone-400">訪日外國人熱線 (JNTO)</p>
                            <p class="font-bold text-sm">050-3816-2787</p>
                            <p class="text-[10px] text-stone-400">24小時 / 英日中韓</p>
                        </div>
                        <a href="tel:05038162787" class="w-10 h-10 bg-stone-200 rounded-full flex items-center justify-center text-stone-600"><i data-lucide="phone" class="w-5 h-5"></i></a>
                    </div>

                    <!-- TECO Osaka (For Nagoya) -->
                    <div class="p-4 bg-red-50 border border-red-100 rounded-xl">
                        <p class="text-xs text-red-500 font-bold mb-2">台北駐大阪經濟文化辦事處 (管轄名古屋)</p>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs text-stone-600">急難救助 (專人)</span>
                            <a href="tel:+819087944568" class="font-bold text-red-600 text-sm">090-8794-4568</a>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-stone-400">一般事項</span>
                            <a href="tel:+81662278623" class="text-xs text-stone-500">06-6227-8623</a>
                        </div>
                    </div>
                </section>
                <!-- 匯率 -->
                <section>
                    <div class="flex justify-between items-center mb-4 px-1">
                        <h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest">匯率換算</h3>
                        <div class="text-[10px] text-stone-400">匯率: <span id="calc-rate-display">loading...</span></div>
                    </div>
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100 flex flex-col gap-4">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-stone-100 flex items-center justify-center font-bold text-stone-600">¥</div>
                            <input id="calc-jpy" type="number" oninput="convertCurrency()" placeholder="輸入日幣金額" class="flex-1 text-2xl font-bold text-stone-800 outline-none bg-transparent placeholder-stone-200" inputmode="numeric">
                        </div>
                        
                        <div class="h-px bg-stone-100 w-full"></div>

                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-[#b08d76] flex items-center justify-center font-bold text-white">NT$</div>
                            <div id="calc-twd" class="flex-1 text-2xl font-bold text-[#b08d76]">0</div>
                        </div>
                    </div>
                </section>
                <!-- Tax Free -->
                <section>
                    <div class="flex justify-between items-center mb-4 px-1"><h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest">免稅湊單</h3><button onclick="resetBatch()" class="text-[10px] text-stone-400 underline">清空</button></div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100 bg-[#fffcfc]">
                        <div class="mb-3 space-y-2">
                            <input id="batch-name" placeholder="品名" class="w-full p-2 bg-white border border-stone-200 rounded text-xs outline-none">
                            <div class="flex gap-2">
                                <input id="batch-price" type="number" placeholder="¥ 單價" class="flex-1 p-2 bg-white border border-stone-200 rounded text-xs outline-none">
                                <input id="batch-qty" type="number" placeholder="數量" value="1" class="w-16 p-2 bg-white border border-stone-200 rounded text-xs outline-none text-center">
                                <button onclick="addBatchItem()" class="bg-[#2c2c2c] text-white px-4 rounded text-xs"><i data-lucide="plus" class="w-3 h-3"></i></button>
                            </div>
                        </div>
                        <div id="batch-list" class="hidden mb-4 space-y-2"></div>
                        <div class="pt-3 border-t border-stone-100">
                            <div class="flex justify-between text-xs mb-2"><span class="text-stone-500">總計</span><span id="batch-total" class="font-bold text-stone-800">¥0</span></div>
                            <div class="w-full bg-stone-100 h-1.5 rounded-full mb-2 overflow-hidden"><div id="batch-progress" class="h-full bg-[#b85c38] transition-all duration-500" style="width: 0%"></div></div>
                            <p id="batch-status" class="text-center text-[10px] font-bold text-[#b85c38] mb-4">還差 ¥5,500</p>
                            <button onclick="saveBatch()" class="w-full py-2 border border-stone-300 text-stone-600 text-xs font-bold uppercase tracking-widest rounded hover:bg-stone-800 hover:text-white transition-colors">存入記帳</button>
                        </div>
                    </div>
                </section>
                
                <!-- Budget -->
                <section>
                    <div class="flex justify-between items-center mb-4 px-1"><h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest">購物記帳</h3><button onclick="resetBudget()" class="text-[10px] text-stone-400 underline">清空</button></div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100">
                        <div class="bg-[#f9f8f4] p-4 rounded mb-5 text-center">
                            <p class="text-[10px] text-stone-400 uppercase tracking-widest mb-1">總花費</p>
                            <p id="total-jpy" class="text-3xl font-serif font-bold text-stone-800">¥0</p>
                            <p id="total-twd" class="text-xs text-stone-500 mt-1 font-light">≈ NT$ 0</p>
                        </div>
                        <div class="mb-4 space-y-2">
                            <input id="budget-name" placeholder="品名" class="w-full p-2 bg-stone-50 border border-stone-100 rounded text-xs outline-none">
                            <div class="flex gap-2">
                                <input id="budget-price" type="number" placeholder="¥ 單價" class="flex-1 p-2 bg-stone-50 border border-stone-100 rounded text-xs outline-none">
                                <input id="budget-qty" type="number" placeholder="數量" value="1" class="w-16 p-2 bg-stone-50 border border-stone-100 rounded text-xs outline-none text-center">
                                <button onclick="addItem()" class="bg-[#2c2c2c] text-white px-4 rounded text-xs"><i data-lucide="plus" class="w-3 h-3"></i></button>
                            </div>
                        </div>
                        <ul id="budget-list" class="space-y-3 max-h-60 overflow-y-auto pr-1"></ul>
                    </div>
                </section>
            </div>
        `;
        lucide.createIcons();
        initChecklist();
        renderBudget();
    }

    // 3. EXECUTE ON LOAD
    document.addEventListener('DOMContentLoaded', () => {
        initDynamicPadding();
        renderDaySelector();
        renderItinerary();
        lucide.createIcons();
        fetchRate();
        fetchLocalWeather(); 
    });
// --- 倒數計時功能 ---
    function updateCountdown() {
        const start = new Date("2026-04-11T00:00:00").getTime();
        const now = new Date().getTime();
        const diff = start - now;
        
        const el = document.getElementById('countdown-timer');
        if(!el) return;

        if (diff > 0) {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            el.innerHTML = `距離出發還有 <span class="text-[#b85c38] font-bold text-sm">${days}</span> 天`;
        } else {
            // 如果已經出發，計算是第幾天
            const dayDiff = Math.abs(diff);
            const currentDay = Math.floor(dayDiff / (1000 * 60 * 60 * 24)) + 1;
            if(currentDay <= 9) {
                el.innerHTML = `旅程第 <span class="text-[#b85c38] font-bold text-sm">${currentDay}</span> 天`;
                // 自動切換到當天的分頁 (可選)
                // if(activeDayIdx !== currentDay - 1) setDay(currentDay - 1);
            } else {
                el.innerHTML = "旅程圓滿結束 ✨";
            }
        }
    }
    // 每秒更新一次
    setInterval(updateCountdown, 1000);
    updateCountdown(); // 初始化執行一次

    window.addEventListener('resize', initDynamicPadding);
</script>
</body>
</html>